import{u as W}from"./CvURW2WX.js";import{D as Y}from"./CMYjgM1t.js";import{r as Z,i as $,n as x,o as J,l as B,u as Q,s as O,v as S,w as C,x as D,y as M}from"./ChsSowZC.js";import{c as X,u as ee}from"./Ul5rOUWU.js";import{u as te,a_ as d,r as f,bb as ae,ba as se,bU as ne,b3 as R,bs as ie,bq as oe}from"./CJ_CGJpm.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";import"./BFk7B0hC.js";import"./BLzfW2ux.js";const fe={__name:"TradingviewFinsc",props:{dataSI:{type:Object,default:()=>{}},dataTP:{type:Object,default:()=>{}}},emits:["update:symbol"],setup(A,{expose:H,emit:E}){const I=E;let i=A;const{on:p,off:b}=X(),{$colorMode:P}=te(),_=d(()=>P.value),h=d(()=>Z()),l=d(()=>$()),s=f(null),m=f(null),w=f(null);let t=null;const{getProfile:F}=W(),{sub:K}=F(),j=K.split("|"),y=d(()=>j[1]),g=ee("symbolLocal","FPT"),q=e=>g.value=e,z=e=>{s.value.chart().setSymbol(e)},N=e=>{var o;m.value=new Y(x,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"}),t=s.value=new TradingView.widget({theme:_.value,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:g.value,interval:"1D",timezone:"Asia/Bangkok",container:e,datafeed:m.value,library_path:"/static/tv/charting_library/",locale:J("lang")||"en",custom_css_url:"/static/tv/themeTV.css",enabled_features:["study_templates"],charts_storage_url:x,client_id:y.value,user_id:y.value,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]}),s.value.headerReady().then(()=>{var L;var r=t.createButton({align:"right"});r.setAttribute("title","Tắt/Mở kết nối giao dịch"),r.innerHTML='<div class="item-headbar"><label class="toggle"> <input class="toggle-checkbox" type="checkbox"> <div class="toggle-switch"></div> <span class="toggle-label">Giao dịch</span> </label></div>';const a=r.querySelector(".toggle-checkbox");var v=t.createButton({align:"right"});if(v.setAttribute("title","Kết nối tài khoản chứng khoán"),v.innerHTML='<div class="item-headbar"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M17.31 8.25h-4.5l1.66-5.07a.94.94 0 0 0-.9-1.18H7.93a.94.94 0 0 0-.93.81L5.76 12.2a.94.94 0 0 0 .93 1.06h4.63l-1.8 7.6a.94.94 0 0 0 1.73.68l6.87-11.87a.94.94 0 0 0-.8-1.41Z"></path></svg></div><div>Kết nối</div></div>',v.addEventListener("click",function(){B()}),console.log("props",i.dataSI.matchPrice),t.onContextMenu(function(n,c){var u;return(u=l.value)!=null&&u.status?Q(t,i,c):[]}),a.addEventListener("change",function(){if(this.checked){const n=h.value&&h.value.login_time?h.value.login_time:0,c=new Date().getTime();console.log(n);const u=c-parseInt(n),U=8*60*60*1e3;if(u<=U)O({status:!0,updateTime:new Date().getTime()});else{const V={title:"Luồng kết nối tới CTCK đã hết hạn",body:"Bấm Yes để tiến hành kết nối lại!",callback:G=>{G&&B()}};a.checked=!1,t.showConfirmDialog(V)}}else{const n={title:"Đóng liên kết giao dịch",body:"Bạn có chắc không?",callback:c=>{c?O({status:!1,updateTime:new Date().getTime()}):a.checked=!0}};t.showConfirmDialog(n)}}),(L=l.value)!=null&&L.status){a.checked=!0;const n=new Event("change");a.dispatchEvent(n)}}),s.value.onChartReady(()=>{s.value.activeChart().onSymbolChanged().subscribe(null,r=>{const a=r.ticker;I("update:symbol",a),q(a)}),s.value.activeChart().onDataLoaded().subscribe(null,function(r){var a;(a=l.value)!=null&&a.status&&(S(t,i,D),C(t,i,M))})}),(o=window.frames[0])==null||o.focus()},k=()=>{var e;(e=l.value)!=null&&e.status&&C(t,i,M)},T=()=>{var e;(e=l.value)!=null&&e.status&&S(t,i,D)};return ae(()=>{N(w.value)}),se(()=>{p("eRefreshLimitOrder",k),p("eRefreshStopOrder",T)}),ne(()=>{b("eRefreshLimitOrder",k),b("eRefreshStopOrder",T)}),R(g,(e,o)=>{o&&m.value.unsubscribeBars(o)}),R(_,e=>{s.value.changeTheme(e)}),H({updateSymbol:z}),(e,o)=>(ie(),oe("div",{ref_key:"finsc_chart",ref:w,class:"trader w-full h-full"},null,512))}};export{fe as default};
