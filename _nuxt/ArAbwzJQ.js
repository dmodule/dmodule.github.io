import{u as te,a_ as C,r as k,bb as ae,b3 as E,bs as se,bq as ne}from"./CJ_CGJpm.js";import{u as oe}from"./BLRsUYzB.js";import{u as ie}from"./B_qkIv1B.js";import{D as re}from"./CkP8s735.js";import{g as H,i as le,m as ce,l as O,n as T,t as de,o as I,p as ue,q as me,s as ge,b as pe,r as ve}from"./BlblDOJL.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";import"./mgkJuNVk.js";import"./BVo3a_yY.js";import"./DOh2-wJO.js";import"./DxqHYnwt.js";import"./BLzfW2ux.js";const Be={__name:"TradingviewFinsc",props:{dataSI:{type:Object,default:()=>{}},dataTP:{type:Object,default:()=>{}}},emits:["update:symbol"],setup(N,{expose:P,emit:A}){const F=A,b=N,{$colorMode:J}=te(),M=C(()=>J.value),r=k(null),y=k(null),q=k(null),{getProfile:R}=ie(),{sub:U}=R(),Y=U.split("|"),B=C(()=>Y[1]),S=oe("symbolLocal","FPT"),$=n=>S.value=n,K=n=>{r.value.chart().setSymbol(n)},X=n=>{var D;y.value=new re(H,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"});var e=r.value=window.tvWidget=new TradingView.widget({theme:M.value,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:S.value,interval:"1D",timezone:"Asia/Bangkok",container:n,datafeed:y.value,library_path:"/static/tv/charting_library/",locale:le("lang")||"en",custom_css_url:"/static/tv/themeTV.css",enabled_features:["study_templates"],charts_storage_url:H,client_id:B.value,user_id:B.value,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]});function z(t){var t=document.querySelector(t);let l=!1,o,d;t.addEventListener("mousedown",function(s){l=!0,o=s.clientX-t.getBoundingClientRect().left,d=s.clientY-t.getBoundingClientRect().top;const i=document.createElement("div");i.classList.add("coverResize"),document.body.appendChild(i);function u(p){l&&(t.style.left=`${p.clientX-o}px`,t.style.top=`${p.clientY-d}px`)}function _(){l=!1,document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",_),i.remove()}document.addEventListener("mousemove",u),document.addEventListener("mouseup",_)})}console.log(ce(3)),r.value.headerReady().then(()=>{var c=e.createButton({align:"right"});c.setAttribute("title","Tắt/Mở kết nối giao dịch"),c.innerHTML='<div class="item-headbar"><label class="toggle"> <input class="toggle-checkbox" type="checkbox"> <div class="toggle-switch"></div> <span class="toggle-label">Giao dịch</span> </label></div>';const t=c.querySelector(".toggle-checkbox");var l=e.createButton({align:"right"});l.setAttribute("title","Kết nối tài khoản chứng khoán"),l.innerHTML='<div class="item-headbar"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M17.31 8.25h-4.5l1.66-5.07a.94.94 0 0 0-.9-1.18H7.93a.94.94 0 0 0-.93.81L5.76 12.2a.94.94 0 0 0 .93 1.06h4.63l-1.8 7.6a.94.94 0 0 0 1.73.68l6.87-11.87a.94.94 0 0 0-.8-1.41Z"></path></svg></div><div>Kết nối</div></div>',l.addEventListener("click",function(){O()});var o=document.createElement("div");o.classList.add("ordercase-cover"),o.innerHTML=`<div class="ordercase"> 
						<button class="order-sellmp">BÁN MP</button> 
						<div> 
							<div class="order-sym-cover">
								<div class="order-sym"></div>
							</div>
							<div class="quant-case"> 
								<input class="order-quant" type="text" value="">
								<input class="order-ppse" style="display: none" type="text" value="" readonly> 
							</div>
						</div> 
						<button class="order-buymp">MUA MP</button> 
					</div>`,document.body.appendChild(o),z(".ordercase");const d=JSON.parse(localStorage.getItem("tradingHandle"));let s=d||{};s.status="unactive",localStorage.setItem("tradingHandle",JSON.stringify(s)),t.addEventListener("change",function(){if(s.updateTime=new Date().getTime(),this.checked){const i=JSON.parse(localStorage.getItem("auth")),u=i?i.login_time:null,p=new Date().getTime()-u,j=8*60*60*1e3;if(p<=j){s.status="active",localStorage.setItem("tradingHandle",JSON.stringify(s)),o.style.display="block";const w=document.querySelector(".order-sym"),g=document.querySelector(".quant-case"),v=g.querySelector(".order-ppse"),h=document.querySelector(".order-quant");w.innerHTML=T(),h.value=d?d.quantIn:0,g.addEventListener("focusin",()=>{v.style.display="block"}),g.addEventListener("focusout",()=>{v.style.display="none"}),h.addEventListener("click",async function(){const a=await de(T(),b.dataSI.ceilingPrice*1e3);a?v.value=a.qmax.toLocaleString("en-US"):v.value="..."}),h.addEventListener("blur",function(){let a=this.value;if(a=parseFloat(a.replace(/,/g,"")),a%100!==0){this.value=a=100;const m={title:"Khối lượng không hợp lệ",body:"Nhập lô chẵn (100, 300, 1500, 2000,...) cổ phiếu"};e.showNoticeDialog(m)}s.quantIn=a,localStorage.setItem("tradingHandle",JSON.stringify(s))}),I().status==="active"&&ue(e,b),e.activeChart().resetData();const Q=document.querySelector(".order-buymp"),V=document.querySelector(".order-sellmp"),W=(a,m,f)=>{const L=m.toLocaleString("en-US"),G={title:"Xác nhận",body:`${a==="BUY"?"Mua":"Bán"} MP ${L} cổ phiếu ${f}?`,callback:async Z=>{if(Z){const ee=await pe(f,a,"MP",0,m);e.showNoticeDialog({title:"Thông báo",body:ve(ee.message)})}}};e.showConfirmDialog(G)},x=(a,m)=>{a.addEventListener("click",()=>{const f=parseFloat(h.value.replace(/,/g,"")),L=T();W(m,f,L)})};x(Q,"BUY"),x(V,"SELL")}else{const w={title:"Luồng kết nối tới CTCK đã hết hạn",body:"Bấm Yes để tiến hành kết nối lại!",callback:g=>{g&&O()}};t.checked=!1,e.showConfirmDialog(w)}}else{const i={title:"Đóng liên kết giao dịch",body:"Bạn có chắc không?",callback:u=>{u?(o.style.display="none",s.status="unactive",localStorage.setItem("tradingHandle",JSON.stringify(s))):t.checked=!0}};e.showConfirmDialog(i)}})}),r.value.onChartReady(()=>{r.value.activeChart().onSymbolChanged().subscribe(null,c=>{const t=c.ticker;F("update:symbol",t),$(t)}),r.value.activeChart().onDataLoaded().subscribe(null,function(c){I().status==="active"&&me(e,b,ge)})}),(D=window.frames[0])==null||D.focus()};return ae(()=>{X(q.value)}),E(S,(n,e)=>{e&&y.value.unsubscribeBars(e)}),E(M,n=>{r.value.changeTheme(n)}),P({updateSymbol:K}),(n,e)=>(se(),ne("div",{ref_key:"finsc_chart",ref:q,class:"trader w-full h-full"},null,512))}};export{Be as default};
