import{u as N,a as O}from"./CYW_P1dk.js";import{u as H}from"./BaQmn4s8.js";import{D as A}from"./Bf_Q3-_e.js";import{bJ as W,u as F,a_ as J,bs as K,bq as R}from"./BD89yi6W.js";import{c as $}from"./_1xW3US5.js";import"./B39OMRwo.js";import"./DxqHYnwt.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";const V={name:"FinscChart",data(){return{tvWidget:null,datafeed:null}},methods:{getParameterByName(s){s=s.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const c=new RegExp("[\\?&]"+s+"=([^&#]*)").exec(window.location.search);return c===null?"":decodeURIComponent(c[1].replace(/\+/g," "))},finscChart(s){var c,u;const a="https://app.finsc.vn/api/v1";this.datafeed=new A(a,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"}),(c=$)==null||c.on("message",(o,n)=>{const i=JSON.parse(n);switch(o.split("/")[3]){case"TP":this.setDataTP(i);break;case"SI":this.setDataSI(i);break;default:return}}),this.tvWidget=window.tvWidget=new TradingView.widget({theme:this.colorMode,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:this.symbol,interval:"1D",timezone:"Asia/Bangkok",container:s,datafeed:this.datafeed,library_path:"/static/tv/charting_library/",locale:this.getParameterByName("lang")||"en",custom_css_url:"/static/tv/themeTV.css",enabled_features:["study_templates"],charts_storage_url:a,client_id:this.userId,user_id:this.userId,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]}),this.tvWidget.headerReady().then(()=>{const o=this.tvWidget;var n=o.createButton({align:"right"});n.setAttribute("title","Tắt/Mở kết nối giao dịch"),n.innerHTML='<div class="item-headbar"><label class="toggle"> <input class="toggle-checkbox" type="checkbox"> <div class="toggle-switch"></div> <span class="toggle-label">Giao dịch</span> </label></div>',n.querySelector(".toggle-checkbox");var i=o.createButton({align:"right"});i.setAttribute("title","Kết nối tài khoản chứng khoán"),i.innerHTML='<div class="item-headbar"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M17.31 8.25h-4.5l1.66-5.07a.94.94 0 0 0-.9-1.18H7.93a.94.94 0 0 0-.93.81L5.76 12.2a.94.94 0 0 0 .93 1.06h4.63l-1.8 7.6a.94.94 0 0 0 1.73.68l6.87-11.87a.94.94 0 0 0-.8-1.41Z"></path></svg></div><div>Kết nối</div></div>',i.addEventListener("click",function(){y()});function p(e,r,g,l){fetch(e,{method:"POST",headers:r,body:JSON.stringify(g)}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t}).then(t=>t.text()).then(t=>{try{t=JSON.parse(t)}catch{}l(t)}).catch(t=>{console.error(t)})}function y(){var e=document.createElement("div");e.classList.add("dialog-popup"),e.id="TV-popup";var r='<div class="logtrade"><h3>Kết nối tài khoản chứng khoán</h3><div class="broker-list"><label><img src="/static/tv/logo-broker/logo-vnds.svg"></label><input type="radio" name="broker" value="vnds" title="Công ty cổ phần chứng khoán VNDIRECT"><label><img src="/static/tv/logo-broker/logo-ssi.svg"></label><input type="radio" name="broker" value="ssi" title="Công ty cổ phần chứng khoán SSI"><label><img src="/static/tv/logo-broker/logo-dnse.svg"></label><input type="radio" name="broker" value="dnse" title="Công ty cổ phần chứng khoán DNSE"><label><img src="/static/tv/logo-broker/logo-vps.svg"></label><input type="radio" name="broker" value="vps" title="Công ty cổ phần chứng khoán VPS"><label><img src="/static/tv/logo-broker/logo-tcbs.svg"></label><input type="radio" name="broker" value="tcbs" title="Công ty cổ phần chứng khoán Kỹ thương"></div><div class="broker"><img class="minhhoa" src="/static/tv/svg-minhhoa/choose.svg"><div class="tbao">Chọn một trong các đối tác của chúng tôi</div></div></div>';e.innerHTML=r,document.body.appendChild(e);const g=document.querySelectorAll('input[name="broker"]'),l=document.querySelector(".broker");g.forEach(t=>{t.addEventListener("click",function(k){let f='<div class="inputBox"><input id="usertrade" type="text" required="required"><img src="/static/feather/user.svg"><span>Tên đăng nhập</span></div><div class="inputBox"><input id="passtrade" type="password" required="required"><img src="/static/feather/lock.svg"><span>Mật khẩu</span></div><div class="inputBox otp hide_sc"><input id="otptrade" type="otp" required="required"><img src="/static/feather/key.svg"><span>OTP</span></div><div id="noti-lgt"></div><div class="inputBox lg2">';switch(t.value){case"vnds":let m=f+'<button id="enter-vndirect" type="submit">Gửi OTP SMS</button></div>';l.innerHTML=m,v("#enter-vndirect","VND",e);break;case"dnse":let _=f+'<button id="enter-dnse" type="submit">Đăng nhập</button></div>';l.innerHTML=_,v("#enter-dnse","DSE",e);break;case"ssi":case"vps":case"tcbs":let S='<div class="pyramid"> <span class="soon">SẮP RA MẮT</span> <div class="tv-shadow"></div> <div> <span style="--i:0;"></span> <span style="--i:1;"></span> <span style="--i:2;"></span> <span style="--i:3;"></span> </div></div>';l.innerHTML=S;break}})}),e.addEventListener("click",function(t){t.target===e&&e.remove()}),e.style.display="block"}function v(e,r,g){document.querySelector(e).addEventListener("click",function(){const t=document.getElementById("usertrade").value,k=document.getElementById("passtrade").value,m=new Date().getTime(),S={rq:"lg1_"+r,username:t,password:k};p("https://app.finsc.vn/api/v1/login",{"Content-Type":"application/json"},S,function(T){const b=document.getElementById("noti-lgt");if(T.message==="Authenticated successfully"){let h=T.data;h.current_broker=r,h.login_time=m,localStorage.setItem("auth",JSON.stringify(h));let B=r==="DSE"?'<div class="sc-success">Nhập Smart OTP lấy từ app EntradeX</div>':'<div class="sc-success">Gửi OTP thành công, kiểm tra tin nhắn</div>';b.innerHTML=B;const L=document.querySelector(".inputBox.lg2");L.innerHTML='<button id="enter-otp" type="submit">Kết nối</button>';const x=document.querySelector(".inputBox.otp");x.style.display="block",document.getElementById("enter-otp").addEventListener("click",function(){const q=document.getElementById("otptrade").value,M="lg2_"+r,C=JSON.parse(localStorage.getItem("auth")).token,E={rq:M},P={"Content-Type":"application/json",Authorization:"Bearer "+C,"smart-otp":q};p("https://app.finsc.vn/api/v1/trading-token",P,E,function(w){if(w.message==="Fetched trading token successfully"){const d=JSON.parse(localStorage.getItem("auth"));d.login_time=m,d.trading_token=w.data.trading_token,console.log(d),localStorage.setItem("auth",JSON.stringify(d));const I='<div class="sc-success">Kết nối thành công</div>';b.innerHTML=I,g.remove();const D={title:"Thông báo",body:"Kết nối thành công"};o.showNoticeDialog(D)}else{const d='<div class="sc-fail">Sai OTP</div>';b.innerHTML=d}})})}else{const h='<div class="sc-fail">Sai tên đăng nhập hoặc mật khẩu</div>';b.innerHTML=h}})})}}),this.tvWidget.onChartReady(()=>{this.tvWidget.activeChart().onSymbolChanged().subscribe(null,o=>{const n=o.ticker;this.$emit("update:symbol",n),this.setSymbol(n)})}),(u=window.frames[0])==null||u.focus()},updateSymbol(s){this.tvWidget.chart().setSymbol(s)}},watch:{symbol(s,a){a&&this.datafeed.unsubscribeBars(a)},colorMode(s){this.tvWidget.changeTheme(s)}},setup(){const{getProfile:s}=H(),{sub:a}=s(),u=a.split("|")[1],{setDataSI:o,setDataTP:n}=N(),i=O("symbolLocal","FPT"),p=e=>i.value=e,{$colorMode:y}=F(),v=J(()=>y.value);return{userId:u,symbol:i,setSymbol:p,setDataSI:o,setDataTP:n,colorMode:v}},mounted(){this.finscChart(this.$el)}},z={ref:"finsc_chart",class:"trader w-full h-full"};function G(s,a,c,u,o,n){return K(),R("div",z,null,512)}const at=W(V,[["render",G]]);export{at as default};
