import{u as m,b as p}from"./CvAXrM3X.js";import{u as b}from"./C-6mcIHo.js";import{D as f,c as _}from"./CrGTrm09.js";import{bL as g,a_ as c,u as y,bs as v,bq as w}from"./C-UWfBKM.js";import"./CnbxAtif.js";import"./BHQX9Zn-.js";import"./DxqHYnwt.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";import"./CsUNmt0V.js";import"./BaGbu_iK.js";const S={name:"FinscChart",data(){return{tvWidget:null,datafeed:null}},methods:{getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return s===null?"":decodeURIComponent(s[1].replace(/\+/g," "))},finscChart(t){var s,r;const e="https://app.finsc.vn/api/v1";this.datafeed=new f(e,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"}),(s=_)==null||s.on("message",(a,o)=>{const i=JSON.parse(o);switch(a.split("/")[3]){case"TP":this.setDataTP(i);break;case"SI":this.setDataSI(i);break;default:return}}),this.tvWidget=window.tvWidget=new TradingView.widget({theme:this.colorMode,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:this.symbol,interval:"1D",timezone:"Asia/Bangkok",container:t,datafeed:this.datafeed,library_path:"/static/tv/charting_library/",locale:this.getParameterByName("lang")||"en",enabled_features:["study_templates"],charts_storage_url:e,client_id:this.userId,user_id:this.userId,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]}),this.tvWidget.onChartReady(()=>{this.tvWidget.activeChart().onSymbolChanged().subscribe(null,a=>{const o=a.ticker;this.setSymbol(o)})}),(r=window.frames[0])==null||r.focus()},updateSymbol(t){this.tvWidget.chart().setSymbol(t)}},watch:{symbol(t,e){e&&this.datafeed.unsubscribeBars(e)},colorMode(t){this.tvWidget.changeTheme(t)}},setup(){const{getProfile:t}=b(),{sub:e}=t(),r=e.split("|")[1],{symbol:a,setSymbol:o,setDataSI:i,setDataTP:n}=m(),l=c(()=>a),{$colorMode:d}=y(),u=c(()=>d.value),{emit:h}=p();return{userId:r,symbol:l,setSymbol:o,setDataSI:i,setDataTP:n,colorMode:u,emit:h}},mounted(){this.emit("eSymbol",{symbol:this.symbol}),this.finscChart(this.$el)}},x={ref:"finsc_chart",class:"trader w-full h-full"};function k(t,e,s,r,a,o){return v(),w("div",x,null,512)}const A=g(S,[["render",k]]);export{A as default};
