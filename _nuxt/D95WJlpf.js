import{C as x,q as J,aB as me,m as j,aC as ne,aD as be,a1 as re,g as W,r as $,z as ge,a0 as ue,h as le,aj as Y,I as xe,a2 as Z,a3 as de,Z as B,ai as Oe,ar as _}from"./DQtYBUwk.js";import{d as Ie,e as Se}from"./D3m3HWes.js";import{o as te,t as ie}from"./B08LnwSc.js";import{u as N,o as I,E as Re,A as H,T as oe,I as X,N as G,a as A}from"./KCL2izxP.js";import{w as ye,n as Ce}from"./BZe_f3FE.js";import{s as Ee}from"./DVDNc22m.js";import{c as z,f as ae,i as we,u as Te}from"./C1P8iW-G.js";import{f as Me,u as ze}from"./uzd8aOQx.js";import{t as Pe,i as Q,l as De}from"./50W24F-h.js";import{i as $e,O as Ae}from"./ZGFGBUHc.js";function q(o,c,t){let n=t.initialDeps??[],e;return()=>{var a,i,l,u;let f;t.key&&((a=t.debug)!=null&&a.call(t))&&(f=Date.now());const p=o();if(!(p.length!==n.length||p.some((M,C)=>n[C]!==M)))return e;n=p;let y;if(t.key&&((i=t.debug)!=null&&i.call(t))&&(y=Date.now()),e=c(...p),t.key&&((l=t.debug)!=null&&l.call(t))){const M=Math.round((Date.now()-f)*100)/100,C=Math.round((Date.now()-y)*100)/100,D=C/16,F=(P,b)=>{for(P=String(P);P.length<b;)P=" "+P;return P};console.info(`%c⏱ ${F(C,5)} /${F(M,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*D,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(u=t==null?void 0:t.onChange)==null||u.call(t,e),e}}function ee(o,c){if(o===void 0)throw new Error("Unexpected undefined");return o}const Fe=(o,c)=>Math.abs(o-c)<1,Ve=(o,c,t)=>{let n;return function(...e){o.clearTimeout(n),n=o.setTimeout(()=>c.apply(this,e),t)}},ke=o=>o,_e=o=>{const c=Math.max(o.startIndex-o.overscan,0),t=Math.min(o.endIndex+o.overscan,o.count-1),n=[];for(let e=c;e<=t;e++)n.push(e);return n},Be=(o,c)=>{const t=o.scrollElement;if(!t)return;const n=o.targetWindow;if(!n)return;const e=i=>{const{width:l,height:u}=i;c({width:Math.round(l),height:Math.round(u)})};if(e(t.getBoundingClientRect()),!n.ResizeObserver)return()=>{};const a=new n.ResizeObserver(i=>{const l=i[0];if(l!=null&&l.borderBoxSize){const u=l.borderBoxSize[0];if(u){e({width:u.inlineSize,height:u.blockSize});return}}e(t.getBoundingClientRect())});return a.observe(t,{box:"border-box"}),()=>{a.unobserve(t)}},se={passive:!0},je=typeof window>"u"?!0:"onscrollend"in window,Le=(o,c)=>{const t=o.scrollElement;if(!t)return;const n=o.targetWindow;if(!n)return;let e=0;const a=je?()=>{}:Ve(n,()=>{c(e,!1)},o.options.isScrollingResetDelay),i=f=>()=>{e=t[o.options.horizontal?"scrollLeft":"scrollTop"],a(),c(e,f)},l=i(!0),u=i(!1);return u(),t.addEventListener("scroll",l,se),t.addEventListener("scrollend",u,se),()=>{t.removeEventListener("scroll",l),t.removeEventListener("scrollend",u)}},Ne=(o,c,t)=>{if(c!=null&&c.borderBoxSize){const n=c.borderBoxSize[0];if(n)return Math.round(n[t.options.horizontal?"inlineSize":"blockSize"])}return Math.round(o.getBoundingClientRect()[t.options.horizontal?"width":"height"])},We=(o,{adjustments:c=0,behavior:t},n)=>{var e,a;const i=o+c;(a=(e=n.scrollElement)==null?void 0:e.scrollTo)==null||a.call(e,{[n.options.horizontal?"left":"top"]:i,behavior:t})};class Ke{constructor(c){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let t=null;const n=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(e=>{e.forEach(a=>{this._measureElement(a.target,a)})}));return{disconnect:()=>{var e;return(e=n())==null?void 0:e.disconnect()},observe:e=>{var a;return(a=n())==null?void 0:a.observe(e,{box:"border-box"})},unobserve:e=>{var a;return(a=n())==null?void 0:a.unobserve(e)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([n,e])=>{typeof e>"u"&&delete t[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ke,rangeExtractor:_e,onChange:()=>{},measureElement:Ne,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,...t}},this.notify=(t,n)=>{var e,a;const{startIndex:i,endIndex:l}=this.range??{startIndex:void 0,endIndex:void 0},u=this.calculateRange();(t||i!==(u==null?void 0:u.startIndex)||l!==(u==null?void 0:u.endIndex))&&((a=(e=this.options).onChange)==null||a.call(e,this,n))},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{var t;const n=this.options.getScrollElement();this.scrollElement!==n&&(this.cleanup(),this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.notify(!1,!1)})),this.unsubs.push(this.options.observeElementOffset(this,(e,a)=>{this.scrollAdjustments=0,this.scrollDirection=a?this.scrollOffset<e?"forward":"backward":null,this.scrollOffset=e;const i=this.isScrolling;this.isScrolling=a,this.notify(i!==a,a)})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurementOptions=q(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(t,n,e,a)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:n,scrollMargin:e,getItemKey:a}),{key:!1}),this.getFurthestMeasurement=(t,n)=>{const e=new Map,a=new Map;for(let i=n-1;i>=0;i--){const l=t[i];if(e.has(l.lane))continue;const u=a.get(l.lane);if(u==null||l.end>u.end?a.set(l.lane,l):l.end<u.end&&e.set(l.lane,!0),e.size===this.options.lanes)break}return a.size===this.options.lanes?Array.from(a.values()).sort((i,l)=>i.end===l.end?i.index-l.index:i.end-l.end)[0]:void 0},this.getMeasurements=q(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:n,scrollMargin:e,getItemKey:a},i)=>{const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const u=this.measurementsCache.slice(0,l);for(let f=l;f<t;f++){const p=a(f),h=this.options.lanes===1?u[f-1]:this.getFurthestMeasurement(u,f),y=h?h.end+this.options.gap:n+e,M=i.get(p),C=typeof M=="number"?M:this.options.estimateSize(f),D=y+C,F=h?h.lane:f%this.options.lanes;u[f]={index:f,start:y,size:C,end:D,key:p,lane:F}}return this.measurementsCache=u,u},{key:!1,debug:()=>this.options.debug}),this.calculateRange=q(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(t,n,e)=>this.range=t.length>0&&n>0?Ue({measurements:t,outerSize:n,scrollOffset:e}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=q(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(t,n,e,a)=>n===null?[]:t({startIndex:n.startIndex,endIndex:n.endIndex,overscan:e,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const n=this.options.indexAttribute,e=t.getAttribute(n);return e?parseInt(e,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(t,n)=>{const e=this.measurementsCache[this.indexFromElement(t)];if(!e||!t.isConnected){this.measureElementCache.forEach((l,u)=>{l===t&&(this.observer.unobserve(t),this.measureElementCache.delete(u))});return}const a=this.measureElementCache.get(e.key);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.measureElementCache.set(e.key,t));const i=this.options.measureElement(t,n,this);this.resizeItem(e,i)},this.resizeItem=(t,n)=>{const e=this.itemSizeCache.get(t.key)??t.size,a=n-e;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(t,a,this):t.start<this.scrollOffset+this.scrollAdjustments)&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(t.index),this.itemSizeCache=new Map(this.itemSizeCache.set(t.key,n)),this.notify(!0,!1))},this.measureElement=t=>{t&&this._measureElement(t,void 0)},this.getVirtualItems=q(()=>[this.getIndexes(),this.getMeasurements()],(t,n)=>{const e=[];for(let a=0,i=t.length;a<i;a++){const l=t[a],u=n[l];e.push(u)}return e},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const n=this.getMeasurements();return ee(n[ce(0,n.length-1,e=>ee(n[e]).start,t)])},this.getOffsetForAlignment=(t,n)=>{const e=this.getSize();n==="auto"&&(t<=this.scrollOffset?n="start":t>=this.scrollOffset+e?n="end":n="start"),n==="start"?t=t:n==="end"?t=t-e:n==="center"&&(t=t-e/2);const a=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[a]:this.scrollElement[a]:0)-this.getSize();return Math.max(Math.min(l,t),0)},this.getOffsetForIndex=(t,n="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const e=ee(this.getMeasurements()[t]);if(n==="auto")if(e.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)n="end";else if(e.start<=this.scrollOffset+this.options.scrollPaddingStart)n="start";else return[this.scrollOffset,n];const a=n==="end"?e.end+this.options.scrollPaddingEnd:e.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n),n]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(t,{align:n="start",behavior:e}={})=>{this.cancelScrollToIndex(),e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,n),{adjustments:void 0,behavior:e})},this.scrollToIndex=(t,{align:n="auto",behavior:e}={})=>{t=Math.max(0,Math.min(t,this.options.count-1)),this.cancelScrollToIndex(),e==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[a,i]=this.getOffsetForIndex(t,n);this._scrollToOffset(a,{adjustments:void 0,behavior:e}),e!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(t))){const[u]=this.getOffsetForIndex(t,i);Fe(u,this.scrollOffset)||this.scrollToIndex(t,{align:i,behavior:e})}else this.scrollToIndex(t,{align:i,behavior:e})}))},this.scrollBy=(t,{behavior:n}={})=>{this.cancelScrollToIndex(),n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+t,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var t;const n=this.getMeasurements();let e;return n.length===0?e=this.options.paddingStart:e=this.options.lanes===1?((t=n[n.length-1])==null?void 0:t.end)??0:Math.max(...n.slice(-this.options.lanes).map(a=>a.end)),e-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(t,{adjustments:n,behavior:e})=>{this.options.scrollToFn(t,{behavior:e,adjustments:n},this)},this.measure=()=>{var t,n;this.itemSizeCache=new Map,(n=(t=this.options).onChange)==null||n.call(t,this,!1)},this.setOptions(c),this.scrollRect=this.options.initialRect,this.scrollOffset=typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(t=>{this.itemSizeCache.set(t.key,t.size)}),this.notify(!1,!1)}}const ce=(o,c,t,n)=>{for(;o<=c;){const e=(o+c)/2|0,a=t(e);if(a<n)o=e+1;else if(a>n)c=e-1;else return e}return o>0?o-1:0};function Ue({measurements:o,outerSize:c,scrollOffset:t}){const n=o.length-1,a=ce(0,n,l=>o[l].start,t);let i=a;for(;i<n&&o[i].end<t+c;)i++;return{startIndex:a,endIndex:i}}function qe(o){const c=new Ke(J(o)),t=me(c),n=c._didMount();return j(()=>J(o).getScrollElement(),e=>{e&&c._willUpdate()},{immediate:!0}),j(()=>J(o),e=>{c.setOptions({...e,onChange:(a,i)=>{var l;ne(t),(l=e.onChange)==null||l.call(e,a,i)}}),c._willUpdate(),ne(t)},{immediate:!0}),be(n),t}function He(o){return qe(x(()=>({observeElementRect:Be,observeElementOffset:Le,scrollToFn:We,...J(o)})))}function Je(){let o=te();return re(()=>o.dispose()),o}function Ye(){let o=Je();return c=>{o.dispose(),o.nextFrame(c)}}var ve=(o=>(o[o.Left=0]="Left",o[o.Right=2]="Right",o))(ve||{}),Ze={};function Ge(o,c){return o===c}var Qe=(o=>(o[o.Open=0]="Open",o[o.Closed=1]="Closed",o))(Qe||{}),Xe=(o=>(o[o.Single=0]="Single",o[o.Multi=1]="Multi",o))(Xe||{}),et=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(et||{});let fe=Symbol("ComboboxContext");function K(o){let c=de(fe,null);if(c===null){let t=new Error(`<${o} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,K),t}return c}let pe=Symbol("VirtualContext"),tt=W({name:"VirtualProvider",setup(o,{slots:c}){let t=K("VirtualProvider"),n=x(()=>{let l=I(t.optionsRef);if(!l)return{start:0,end:0};let u=window.getComputedStyle(l);return{start:parseFloat(u.paddingBlockStart||u.paddingTop),end:parseFloat(u.paddingBlockEnd||u.paddingBottom)}}),e=He(x(()=>({scrollPaddingStart:n.value.start,scrollPaddingEnd:n.value.end,count:t.virtual.value.options.length,estimateSize(){return 40},getScrollElement(){return I(t.optionsRef)},overscan:12}))),a=x(()=>{var l;return(l=t.virtual.value)==null?void 0:l.options}),i=$(0);return j([a],()=>{i.value+=1}),ue(pe,t.virtual.value?e:null),()=>[Y("div",{style:{position:"relative",width:"100%",height:`${e.value.getTotalSize()}px`},ref:l=>{if(l){if(typeof process<"u"&&Ze.JEST_WORKER_ID!==void 0||t.activationTrigger.value===0)return;t.activeOptionIndex.value!==null&&t.virtual.value.options.length>t.activeOptionIndex.value&&e.value.scrollToIndex(t.activeOptionIndex.value)}}},e.value.getVirtualItems().map(l=>Oe(c.default({option:t.virtual.value.options[l.index],open:t.comboboxState.value===0})[0],{key:`${i.value}-${l.index}`,"data-index":l.index,"aria-setsize":t.virtual.value.options.length,"aria-posinset":l.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${l.start}px)`,overflowAnchor:"none"}})))]}}),vt=W({name:"Combobox",emits:{"update:modelValue":o=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],nullable:!0,default:null},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1},immediate:{type:[Boolean],default:!1},virtual:{type:Object,default:null}},inheritAttrs:!1,setup(o,{slots:c,attrs:t,emit:n}){let e=$(1),a=$(null),i=$(null),l=$(null),u=$(null),f=$({static:!1,hold:!1}),p=$([]),h=$(null),y=$(2),M=$(!1);function C(s=d=>d){let d=h.value!==null?p.value[h.value]:null,m=s(p.value.slice()),g=m.length>0&&m[0].dataRef.order.value!==null?m.sort((T,k)=>T.dataRef.order.value-k.dataRef.order.value):Ae(m,T=>I(T.dataRef.domRef)),w=d?g.indexOf(d):null;return w===-1&&(w=null),{options:g,activeOptionIndex:w}}let D=x(()=>o.multiple?1:0),F=x(()=>o.nullable),[P,b]=Ie(x(()=>o.modelValue),s=>n("update:modelValue",s),x(()=>o.defaultValue)),E=x(()=>P.value===void 0?N(D.value,{1:[],0:void 0}):P.value),V=null,v=null;function S(s){return N(D.value,{0(){return b==null?void 0:b(s)},1:()=>{let d=_(r.value.value).slice(),m=_(s),g=d.findIndex(w=>r.compare(m,_(w)));return g===-1?d.push(m):d.splice(g,1),b==null?void 0:b(d)}})}let R=x(()=>{});j([R],([s],[d])=>{if(r.virtual.value&&s&&d&&h.value!==null){let m=s.indexOf(d[h.value]);m!==-1?h.value=m:h.value=null}});let r={comboboxState:e,value:E,mode:D,compare(s,d){if(typeof o.by=="string"){let m=o.by;return(s==null?void 0:s[m])===(d==null?void 0:d[m])}return o.by===null?Ge(s,d):o.by(s,d)},calculateIndex(s){return r.virtual.value?o.by===null?r.virtual.value.options.indexOf(s):r.virtual.value.options.findIndex(d=>r.compare(d,s)):p.value.findIndex(d=>r.compare(d.dataRef.value,s))},defaultValue:x(()=>o.defaultValue),nullable:F,immediate:x(()=>!1),virtual:x(()=>null),inputRef:i,labelRef:a,buttonRef:l,optionsRef:u,disabled:x(()=>o.disabled),options:p,change(s){b(s)},activeOptionIndex:x(()=>{if(M.value&&h.value===null&&(r.virtual.value?r.virtual.value.options.length>0:p.value.length>0)){if(r.virtual.value){let d=r.virtual.value.options.findIndex(m=>{var g;return!((g=r.virtual.value)!=null&&g.disabled(m))});if(d!==-1)return d}let s=p.value.findIndex(d=>!d.dataRef.disabled);if(s!==-1)return s}return h.value}),activationTrigger:y,optionsPropsRef:f,closeCombobox(){M.value=!1,!o.disabled&&e.value!==1&&(e.value=1,h.value=null)},openCombobox(){if(M.value=!0,!o.disabled&&e.value!==0){if(r.value.value){let s=r.calculateIndex(r.value.value);s!==-1&&(h.value=s)}e.value=0}},setActivationTrigger(s){y.value=s},goToOption(s,d,m){M.value=!1,V!==null&&cancelAnimationFrame(V),V=requestAnimationFrame(()=>{if(o.disabled||u.value&&!f.value.static&&e.value===1)return;if(r.virtual.value){h.value=s===z.Specific?d:ae({focus:s},{resolveItems:()=>r.virtual.value.options,resolveActiveIndex:()=>{var T,k;return(k=(T=r.activeOptionIndex.value)!=null?T:r.virtual.value.options.findIndex(L=>{var U;return!((U=r.virtual.value)!=null&&U.disabled(L))}))!=null?k:null},resolveDisabled:T=>r.virtual.value.disabled(T),resolveId(){throw new Error("Function not implemented.")}}),y.value=m??2;return}let g=C();if(g.activeOptionIndex===null){let T=g.options.findIndex(k=>!k.dataRef.disabled);T!==-1&&(g.activeOptionIndex=T)}let w=s===z.Specific?d:ae({focus:s},{resolveItems:()=>g.options,resolveActiveIndex:()=>g.activeOptionIndex,resolveId:T=>T.id,resolveDisabled:T=>T.dataRef.disabled});h.value=w,y.value=m??2,p.value=g.options})},selectOption(s){let d=p.value.find(g=>g.id===s);if(!d)return;let{dataRef:m}=d;S(m.value)},selectActiveOption(){if(r.activeOptionIndex.value!==null){if(r.virtual.value)S(r.virtual.value.options[r.activeOptionIndex.value]);else{let{dataRef:s}=p.value[r.activeOptionIndex.value];S(s.value)}r.goToOption(z.Specific,r.activeOptionIndex.value)}},registerOption(s,d){let m=ge({id:s,dataRef:d});if(r.virtual.value){p.value.push(m);return}v&&cancelAnimationFrame(v);let g=C(w=>(w.push(m),w));h.value===null&&r.isSelected(d.value.value)&&(g.activeOptionIndex=g.options.indexOf(m)),p.value=g.options,h.value=g.activeOptionIndex,y.value=2,g.options.some(w=>!I(w.dataRef.domRef))&&(v=requestAnimationFrame(()=>{let w=C();p.value=w.options,h.value=w.activeOptionIndex}))},unregisterOption(s,d){if(V!==null&&cancelAnimationFrame(V),d&&(M.value=!0),r.virtual.value){p.value=p.value.filter(g=>g.id!==s);return}let m=C(g=>{let w=g.findIndex(T=>T.id===s);return w!==-1&&g.splice(w,1),g});p.value=m.options,h.value=m.activeOptionIndex,y.value=2},isSelected(s){return N(D.value,{0:()=>r.compare(_(r.value.value),_(s)),1:()=>_(r.value.value).some(d=>r.compare(_(d),_(s)))})},isActive(s){return h.value===r.calculateIndex(s)}};ye([i,l,u],()=>r.closeCombobox(),x(()=>e.value===0)),ue(fe,r),Pe(x(()=>N(e.value,{0:Q.Open,1:Q.Closed})));let O=x(()=>{var s;return(s=I(i))==null?void 0:s.closest("form")});return le(()=>{j([O],()=>{if(!O.value||o.defaultValue===void 0)return;function s(){r.change(o.defaultValue)}return O.value.addEventListener("reset",s),()=>{var d;(d=O.value)==null||d.removeEventListener("reset",s)}},{immediate:!0})}),()=>{var s,d,m;let{name:g,disabled:w,form:T,...k}=o,L={open:e.value===0,disabled:w,activeIndex:r.activeOptionIndex.value,activeOption:r.activeOptionIndex.value===null?null:r.virtual.value?r.virtual.value.options[(s=r.activeOptionIndex.value)!=null?s:0]:(m=(d=r.options.value[r.activeOptionIndex.value])==null?void 0:d.dataRef.value)!=null?m:null,value:E.value};return Y(xe,[...g!=null&&E.value!=null?Se({[g]:E.value}).map(([U,he])=>Y(Me,Re({features:ze.Hidden,key:U,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:T,disabled:w,name:U,value:he}))):[],H({theirProps:{...t,...oe(k,["by","defaultValue","immediate","modelValue","multiple","nullable","onUpdate:modelValue","virtual"])},ourProps:{},slot:L,slots:c,attrs:t,name:"Combobox"})])}}}),ft=W({name:"ComboboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(o,{attrs:c,slots:t,expose:n}){var e;let a=(e=o.id)!=null?e:`headlessui-combobox-button-${X()}`,i=K("ComboboxButton");n({el:i.buttonRef,$el:i.buttonRef});function l(p){i.disabled.value||(i.comboboxState.value===0?i.closeCombobox():(p.preventDefault(),i.openCombobox()),B(()=>{var h;return(h=I(i.inputRef))==null?void 0:h.focus({preventScroll:!0})}))}function u(p){switch(p.key){case A.ArrowDown:p.preventDefault(),p.stopPropagation(),i.comboboxState.value===1&&i.openCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case A.ArrowUp:p.preventDefault(),p.stopPropagation(),i.comboboxState.value===1&&(i.openCombobox(),B(()=>{i.value.value||i.goToOption(z.Last)})),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case A.Escape:if(i.comboboxState.value!==0)return;p.preventDefault(),i.optionsRef.value&&!i.optionsPropsRef.value.static&&p.stopPropagation(),i.closeCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return}}let f=Ee(x(()=>({as:o.as,type:c.type})),i.buttonRef);return()=>{var p,h;let y={open:i.comboboxState.value===0,disabled:i.disabled.value,value:i.value.value},{...M}=o,C={ref:i.buttonRef,id:a,type:f.value,tabindex:"-1","aria-haspopup":"listbox","aria-controls":(p=I(i.optionsRef))==null?void 0:p.id,"aria-expanded":i.comboboxState.value===0,"aria-labelledby":i.labelRef.value?[(h=I(i.labelRef))==null?void 0:h.id,a].join(" "):void 0,disabled:i.disabled.value===!0?!0:void 0,onKeydown:u,onClick:l};return H({ourProps:C,theirProps:M,slot:y,attrs:c,slots:t,name:"ComboboxButton"})}}}),pt=W({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:null}},emits:{change:o=>!0},setup(o,{emit:c,attrs:t,slots:n,expose:e}){var a;let i=(a=o.id)!=null?a:`headlessui-combobox-input-${X()}`,l=K("ComboboxInput"),u=x(()=>$e(I(l.inputRef))),f={value:!1};e({el:l.inputRef,$el:l.inputRef});function p(){l.change(null);let v=I(l.optionsRef);v&&(v.scrollTop=0),l.goToOption(z.Nothing)}let h=x(()=>{var v;let S=l.value.value;return I(l.inputRef)?typeof o.displayValue<"u"&&S!==void 0?(v=o.displayValue(S))!=null?v:"":typeof S=="string"?S:"":""});le(()=>{j([h,l.comboboxState,u],([v,S],[R,r])=>{if(f.value)return;let O=I(l.inputRef);O&&((r===0&&S===1||v!==R)&&(O.value=v),requestAnimationFrame(()=>{var s;if(f.value||!O||((s=u.value)==null?void 0:s.activeElement)!==O)return;let{selectionStart:d,selectionEnd:m}=O;Math.abs((m??0)-(d??0))===0&&d===0&&O.setSelectionRange(O.value.length,O.value.length)}))},{immediate:!0}),j([l.comboboxState],([v],[S])=>{if(v===0&&S===1){if(f.value)return;let R=I(l.inputRef);if(!R)return;let r=R.value,{selectionStart:O,selectionEnd:s,selectionDirection:d}=R;R.value="",R.value=r,d!==null?R.setSelectionRange(O,s,d):R.setSelectionRange(O,s)}})});let y=$(!1);function M(){y.value=!0}function C(){te().nextFrame(()=>{y.value=!1})}let D=Ye();function F(v){switch(f.value=!0,D(()=>{f.value=!1}),v.key){case A.Enter:if(f.value=!1,l.comboboxState.value!==0||y.value)return;if(v.preventDefault(),v.stopPropagation(),l.activeOptionIndex.value===null){l.closeCombobox();return}l.selectActiveOption(),l.mode.value===0&&l.closeCombobox();break;case A.ArrowDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),N(l.comboboxState.value,{0:()=>l.goToOption(z.Next),1:()=>l.openCombobox()});case A.ArrowUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),N(l.comboboxState.value,{0:()=>l.goToOption(z.Previous),1:()=>{l.openCombobox(),B(()=>{l.value.value||l.goToOption(z.Last)})}});case A.Home:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(z.First);case A.PageUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(z.First);case A.End:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(z.Last);case A.PageDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),l.goToOption(z.Last);case A.Escape:if(f.value=!1,l.comboboxState.value!==0)return;v.preventDefault(),l.optionsRef.value&&!l.optionsPropsRef.value.static&&v.stopPropagation(),l.nullable.value&&l.mode.value===0&&l.value.value===null&&p(),l.closeCombobox();break;case A.Tab:if(f.value=!1,l.comboboxState.value!==0)return;l.mode.value===0&&l.activationTrigger.value!==1&&l.selectActiveOption(),l.closeCombobox();break}}function P(v){c("change",v),l.nullable.value&&l.mode.value===0&&v.target.value===""&&p(),l.openCombobox()}function b(v){var S,R,r;let O=(S=v.relatedTarget)!=null?S:ie.find(s=>s!==v.currentTarget);if(f.value=!1,!((R=I(l.optionsRef))!=null&&R.contains(O))&&!((r=I(l.buttonRef))!=null&&r.contains(O))&&l.comboboxState.value===0)return v.preventDefault(),l.mode.value===0&&(l.nullable.value&&l.value.value===null?p():l.activationTrigger.value!==1&&l.selectActiveOption()),l.closeCombobox()}function E(v){var S,R,r;let O=(S=v.relatedTarget)!=null?S:ie.find(s=>s!==v.currentTarget);(R=I(l.buttonRef))!=null&&R.contains(O)||(r=I(l.optionsRef))!=null&&r.contains(O)||l.disabled.value||l.immediate.value&&l.comboboxState.value!==0&&(l.openCombobox(),te().nextFrame(()=>{l.setActivationTrigger(1)}))}let V=x(()=>{var v,S,R,r;return(r=(R=(S=o.defaultValue)!=null?S:l.defaultValue.value!==void 0?(v=o.displayValue)==null?void 0:v.call(o,l.defaultValue.value):null)!=null?R:l.defaultValue.value)!=null?r:""});return()=>{var v,S,R,r,O,s,d;let m={open:l.comboboxState.value===0},{displayValue:g,onChange:w,...T}=o,k={"aria-controls":(v=l.optionsRef.value)==null?void 0:v.id,"aria-expanded":l.comboboxState.value===0,"aria-activedescendant":l.activeOptionIndex.value===null?void 0:l.virtual.value?(S=l.options.value.find(L=>!l.virtual.value.disabled(L.dataRef.value)&&l.compare(L.dataRef.value,l.virtual.value.options[l.activeOptionIndex.value])))==null?void 0:S.id:(R=l.options.value[l.activeOptionIndex.value])==null?void 0:R.id,"aria-labelledby":(s=(r=I(l.labelRef))==null?void 0:r.id)!=null?s:(O=I(l.buttonRef))==null?void 0:O.id,"aria-autocomplete":"list",id:i,onCompositionstart:M,onCompositionend:C,onKeydown:F,onInput:P,onFocus:E,onBlur:b,role:"combobox",type:(d=t.type)!=null?d:"text",tabIndex:0,ref:l.inputRef,defaultValue:V.value,disabled:l.disabled.value===!0?!0:void 0};return H({ourProps:k,theirProps:T,slot:m,attrs:t,slots:n,features:G.RenderStrategy|G.Static,name:"ComboboxInput"})}}}),ht=W({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(o,{attrs:c,slots:t,expose:n}){let e=K("ComboboxOptions"),a=`headlessui-combobox-options-${X()}`;n({el:e.optionsRef,$el:e.optionsRef}),Z(()=>{e.optionsPropsRef.value.static=o.static}),Z(()=>{e.optionsPropsRef.value.hold=o.hold});let i=De(),l=x(()=>i!==null?(i.value&Q.Open)===Q.Open:e.comboboxState.value===0);we({container:x(()=>I(e.optionsRef)),enabled:x(()=>e.comboboxState.value===0),accept(f){return f.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:f.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(f){f.setAttribute("role","none")}});function u(f){f.preventDefault()}return()=>{var f,p,h;let y={open:e.comboboxState.value===0},M={"aria-labelledby":(h=(f=I(e.labelRef))==null?void 0:f.id)!=null?h:(p=I(e.buttonRef))==null?void 0:p.id,id:a,ref:e.optionsRef,role:"listbox","aria-multiselectable":e.mode.value===1?!0:void 0,onMousedown:u},C=oe(o,["hold"]);return H({ourProps:M,theirProps:C,slot:y,attrs:c,slots:e.virtual.value&&e.comboboxState.value===0?{...t,default:()=>[Y(tt,{},t.default)]}:t,features:G.RenderStrategy|G.Static,visible:l.value,name:"ComboboxOptions"})}}}),mt=W({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},order:{type:[Number],default:null}},setup(o,{slots:c,attrs:t,expose:n}){let e=K("ComboboxOption"),a=`headlessui-combobox-option-${X()}`,i=$(null),l=x(()=>o.disabled);n({el:i,$el:i});let u=x(()=>{var b;return e.virtual.value?e.activeOptionIndex.value===e.calculateIndex(o.value):e.activeOptionIndex.value===null?!1:((b=e.options.value[e.activeOptionIndex.value])==null?void 0:b.id)===a}),f=x(()=>e.isSelected(o.value)),p=de(pe,null),h=x(()=>({disabled:o.disabled,value:o.value,domRef:i,order:x(()=>o.order)}));le(()=>e.registerOption(a,h)),re(()=>e.unregisterOption(a,u.value)),Z(()=>{let b=I(i);b&&(p==null||p.value.measureElement(b))}),Z(()=>{e.comboboxState.value===0&&u.value&&(e.virtual.value||e.activationTrigger.value!==0&&B(()=>{var b,E;return(E=(b=I(i))==null?void 0:b.scrollIntoView)==null?void 0:E.call(b,{block:"nearest"})}))});function y(b){b.preventDefault(),b.button===ve.Left&&(l.value||(e.selectOption(a),Ce()||requestAnimationFrame(()=>{var E;return(E=I(e.inputRef))==null?void 0:E.focus({preventScroll:!0})}),e.mode.value===0&&e.closeCombobox()))}function M(){var b;if(o.disabled||(b=e.virtual.value)!=null&&b.disabled(o.value))return e.goToOption(z.Nothing);let E=e.calculateIndex(o.value);e.goToOption(z.Specific,E)}let C=Te();function D(b){C.update(b)}function F(b){var E;if(!C.wasMoved(b)||o.disabled||(E=e.virtual.value)!=null&&E.disabled(o.value)||u.value)return;let V=e.calculateIndex(o.value);e.goToOption(z.Specific,V,0)}function P(b){var E;C.wasMoved(b)&&(o.disabled||(E=e.virtual.value)!=null&&E.disabled(o.value)||u.value&&(e.optionsPropsRef.value.hold||e.goToOption(z.Nothing)))}return()=>{let{disabled:b}=o,E={active:u.value,selected:f.value,disabled:b},V={id:a,ref:i,role:"option",tabIndex:b===!0?void 0:-1,"aria-disabled":b===!0?!0:void 0,"aria-selected":f.value,disabled:void 0,onMousedown:y,onFocus:M,onPointerenter:D,onMouseenter:D,onPointermove:F,onMousemove:F,onPointerleave:P,onMouseleave:P},v=oe(o,["order","value"]);return H({ourProps:V,theirProps:v,slot:E,attrs:t,slots:c,name:"ComboboxOption"})}}});export{pt as i,vt as l,ft as n,mt as r,ht as u};
