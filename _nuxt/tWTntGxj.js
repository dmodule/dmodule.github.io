import{b as $}from"./CEPNV0NR.js";import{a as T}from"./2DHyWFFj.js";import{bt as G}from"./B2zngJ72.js";const I=T().API_FINSC,w=()=>`${I}/order-service/${y().current_broker}`,y=()=>{const{auth:t}=$();return t},C=t=>{const{setAuth:e}=$();e(t)},A=t=>{const e={"Content-Type":"application/json",Authorization:"Bearer "+y().token};return t&&(e["trading-token"]=y().trading_token),e},V=t=>({"Cannot place order on aom halted symbol":"Không thể đặt lệnh trong phiên GD thỏa thuận","Ordered successfully":"Gửi lệnh thành công","Trade quantity not enough":"Không đủ cổ phiếu để đặt lệnh","Quantity is invalid":"Khối lượng không hợp lệ","quantity is required":"Khối lượng không được để trống","Cannot place order with that order type on BEGIN OF DAY session":"Không thể đặt loại lệnh này ngoài phiên GD","deal not found":"Bạn không sở hữu cổ phiếu này","Cannot place order on this session":"Hiện tại chưa cho phép đặt lệnh trước, chờ sau 20h"})[t]||"Lỗi không xác định",z=async(t,e)=>{const n=`${w()}/accounts/${y().account_no}/ppse?symbol=${t}&price=${e}`,o=await _(n,A());if((o==null?void 0:o.status)===!0)return o.data},K=()=>1769,J=async(t,e,n,o,i)=>{const r={symbol:t,side:e,orderType:n,price:o,quantity:i,loanPackageId:K(),accountNo:y().account_no};return await F(`${w()}/orders`,A(!0),r)},U=t=>{const e=new Date;return e.setDate(e.getDate()+t),e.toISOString().split("T")[0]},Y=()=>{var t=document.createElement("div");t.classList.add("dialog-popup"),t.id="TV-popup";var e='<div class="logtrade"><h3>Kết nối tài khoản chứng khoán</h3><div class="broker-list"><label><img src="/static/tv/logo-broker/logo-vnds.svg"></label><input type="radio" name="broker" value="vnds" title="Công ty cổ phần chứng khoán VNDIRECT"><label><img src="/static/tv/logo-broker/logo-ssi.svg"></label><input type="radio" name="broker" value="ssi" title="Công ty cổ phần chứng khoán SSI"><label><img src="/static/tv/logo-broker/logo-dnse.svg"></label><input type="radio" name="broker" value="dnse" title="Công ty cổ phần chứng khoán DNSE"><label><img src="/static/tv/logo-broker/logo-vps.svg"></label><input type="radio" name="broker" value="vps" title="Công ty cổ phần chứng khoán VPS"><label><img src="/static/tv/logo-broker/logo-tcbs.svg"></label><input type="radio" name="broker" value="tcbs" title="Công ty cổ phần chứng khoán Kỹ thương"></div><div class="broker"><img class="minhhoa" src="/static/tv/svg-minhhoa/choose.svg"><div class="tbao">Chọn một trong các đối tác của chúng tôi</div></div></div>';t.innerHTML=e,document.body.appendChild(t);const n=document.querySelectorAll('input[name="broker"]'),o=document.querySelector(".broker");n.forEach(i=>{i.addEventListener("click",function(r){let d='<div class="inputBox"><input id="usertrade" type="text" required="required"><img src="/static/feather/user.svg"><span>Tên đăng nhập</span></div><div class="inputBox"><input id="passtrade" type="password" required="required"><img src="/static/feather/lock.svg"><span>Mật khẩu</span></div><div class="inputBox otp hide_sc"><input id="otptrade" type="otp" required="required"><img src="/static/feather/key.svg"><span>OTP</span></div>';switch(i.value){case"vnds":let k=d+'<div id="noti-lgt"></div><div class="inputBox lg2"><button id="enter-vndirect" type="submit">Gửi OTP SMS</button></div>';o.innerHTML=k,O("#enter-vndirect","VNDS",t);break;case"dnse":let h=d+'<div class="otp-options"><label><input type="radio" name="otp-method" value="email"> Email OTP</label><label><input type="radio" name="otp-method" value="smart" checked> Smart OTP</label></div><div id="noti-lgt"></div><div class="inputBox lg2"><button id="enter-dnse" type="submit">Đăng nhập</button></div>';o.innerHTML=h,O("#enter-dnse","DNSE",t);break;case"ssi":case"vps":case"tcbs":let m='<div class="pyramid"> <span class="soon">SẮP RA MẮT</span> <div class="tv-shadow"></div> <div> <span style="--i:0;"></span> <span style="--i:1;"></span> <span style="--i:2;"></span> <span style="--i:3;"></span> </div></div>';o.innerHTML=m;break}})}),t.addEventListener("click",function(i){i.target===t&&t.remove()}),t.style.display="block"},O=(t,e,n)=>{const o=G();document.querySelector(t).addEventListener("click",async function(){const r=document.getElementById("usertrade").value,d=document.getElementById("passtrade").value,h=new Date().getTime(),m={username:r,password:d},L={"Content-Type":"application/json"};await F(`${I}/order-service/${e}/login`,L,m,async function(f){const a=document.getElementById("noti-lgt");if(f.message==="Authenticated successfully"){let c=f.data;c.current_broker=e,c.login_time=h,C(c);let l=e==="DNSE"?'<div class="sc-success">Đăng nhập thành công, tiếp tục xác thực OTP</div>':'<div class="sc-success">Gửi OTP thành công, kiểm tra tin nhắn</div>';a.innerHTML=l;const B=document.querySelector(".inputBox.lg2");B.innerHTML='<button id="enter-otp" type="submit">Kết nối</button>';const E=document.querySelector(".inputBox.otp");E.style.display="block";const b={"Content-Type":"application/json",Authorization:"Bearer "+c.token};await _(`${w()}/accounts`,b,function(u){u.message==="Fetched user information successfully"&&(c.account_no=u.data.default.id,c.name=u.data.default.name,C(c))});const q=document.querySelector('input[name="otp-method"]:checked').value;q==="email"&&await _(`${w()}/otp`,b,function(u){if(u.message==="Sent email otp successfully"){const p='<div class="sc-success">Gửi OTP thành công, kiểm tra email</div>';a.innerHTML=p}else{const p='<div class="sc-fail">Gửi OTP thất bại</div>';a.innerHTML=p}}),document.getElementById("enter-otp").addEventListener("click",async function(){const u=document.getElementById("otptrade").value,x={"Content-Type":"application/json",Authorization:"Bearer "+y().token,...q==="email"?{otp:u}:{"smart-otp":u}};await F(`${w()}/trading-token`,x,null,function(S){if(S.message==="Fetched trading token successfully"){c.trading_token=S.data.trading_token,console.log(c),C(c);const v='<div class="sc-success">Kết nối thành công</div>';a.innerHTML=v,n.remove(),console.log({title:"Thông báo",body:"Kết nối thành công"}),o.add({title:"Đăng nhập thành công",description:"",icon:"i-ri-check-double-line"})}else{const v='<div class="sc-fail">Sai OTP, hãy nhập lại</div>';a.innerHTML=v}})})}else{const c='<div class="sc-fail">Sai tên đăng nhập hoặc mật khẩu</div>';a.innerHTML=c}})})};async function F(t,e,n,o=null){try{const i=await fetch(t,{method:"POST",headers:e,body:JSON.stringify(n)});if(!i.ok)throw new Error("Network response was not ok");const r=await i.json();if(o)o(r);else return r}catch(i){if(console.error(i),o)o(null);else return null}}async function _(t,e,n=null){try{const o=await fetch(t,{method:"GET",headers:e});if(!o.ok)throw new Error("Network response was not ok");const i=await o.json();if(n)n(i);else return i}catch(o){if(console.error(o),n)n(null);else return null}}const W=t=>{t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))},X=(t={},e={})=>{var p,x,S,v;const{basicPrice:n=0,matchPrice:o=0,matchQtty:i=0}=t,r=Math.max(i*10,...((p=e==null?void 0:e.bid)==null?void 0:p.map(s=>s.qtty*10))||[],...((x=e==null?void 0:e.ask)==null?void 0:x.map(s=>s.qtty*10))||[]),d=(s,g)=>{const M=r?g*10/r*100:0,H=n?((s-n)/n*100).toFixed(1):"0.0",N=s-n;return{changedRatio:H,percentChange:M.toFixed(1),changed:N.toFixed(2)}},k=((S=e==null?void 0:e.bid)==null?void 0:S.map(s=>({price:s.price,qtty:(s.qtty*10).toLocaleString(),...d(s.price,s.qtty)})))||[],h=((v=e==null?void 0:e.ask)==null?void 0:v.map(s=>({price:s.price,qtty:(s.qtty*10).toLocaleString(),...d(s.price,s.qtty)})))||[],m={price:o,qtty:(i*10).toLocaleString(),...d(o,i)},L=[...k,...h].sort((s,g)=>(g==null?void 0:g.price)-(s==null?void 0:s.price));L.splice(3,0,m);const f=s=>!s||s.length===0?0:s.reduce((g,M)=>g+M.qtty*10,0),a=f(e==null?void 0:e.ask),c=f(e==null?void 0:e.bid),l=a+c,B=l?(a/l*100).toFixed(6):"0.0",E=l?(c/l*100).toFixed(6):"0.0",b=t.buyForeignQtty||0,q=t.sellForeignQtty||0,D=l?(b/l*100).toFixed(1):"0.0",u=l?(q/l*100).toFixed(1):"0.0";return{bids:k,asks:h,matchData:m,list:L,sumBuy:a,sumSell:c,sumBuyPercentage:B,sumSellPercentage:E,buyForeign:b,sellForeign:q,buyForeignPercentage:D,sellForeignPercentage:u}};function Z(t,e=!1){if(e){const n=new Date;console.log(`${n.toLocaleTimeString()}.${n.getMilliseconds()}> ${t}`)}}function P(t){return t===void 0?"":typeof t=="string"?t:t.message}export{J as a,P as b,Z as c,U as d,V as e,I as f,W as g,X as h,Y as l,z as t};
