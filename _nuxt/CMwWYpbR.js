import{u as Z,b as j}from"./CEPNV0NR.js";import{u as ee}from"./2DHyWFFj.js";import{D as te}from"./C_xVrS54.js";import{f as C,g as ae,d as ne,l as E,t as se,a as oe,e as le}from"./tWTntGxj.js";import{u as ie,a_ as L,r as M,bb as re,b3 as H,bs as ce,bq as de}from"./B2zngJ72.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";import"./BhKXCFn3.js";import"./CJ2HXv4E.js";import"./DH-5LqSd.js";import"./DxqHYnwt.js";import"./CXaQVNdb.js";const Le={__name:"TradingviewFinsc",emits:["update:symbol"],setup(ue,{expose:I,emit:N}){const P=N,{$colorMode:O}=ie(),B=L(()=>O.value),d=M(null),y=M(null),T=M(null),{getProfile:A}=ee(),{sub:F}=A(),R=F.split("|"),q=L(()=>R[1]),b=Z("symbolLocal","FPT"),U=s=>b.value=s,Y=s=>{d.value.chart().setSymbol(s)},$=s=>{var x;y.value=new te(C,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"});var t=d.value=window.tvWidget=new TradingView.widget({theme:B.value,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:b.value,interval:"1D",timezone:"Asia/Bangkok",container:s,datafeed:y.value,library_path:"/static/tv/charting_library/",locale:ae("lang")||"en",custom_css_url:"/static/tv/themeTV.css",enabled_features:["study_templates"],charts_storage_url:C,client_id:q.value,user_id:q.value,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]});function J(e){var e=document.querySelector(e);let r=!1,o,m;e.addEventListener("mousedown",function(n){r=!0,o=n.clientX-e.getBoundingClientRect().left,m=n.clientY-e.getBoundingClientRect().top;const l=document.createElement("div");l.classList.add("coverResize"),document.body.appendChild(l);function g(h){r&&(e.style.left=`${h.clientX-o}px`,e.style.top=`${h.clientY-m}px`)}function _(){r=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",_),l.remove()}document.addEventListener("mousemove",g),document.addEventListener("mouseup",_)})}function S(){return localStorage.getItem("symbolLocal").replace(/"/g,"")}console.log(ne(3)),d.value.headerReady().then(()=>{var u=t.createButton({align:"right"});u.setAttribute("title","Tắt/Mở kết nối giao dịch"),u.innerHTML='<div class="item-headbar"><label class="toggle"> <input class="toggle-checkbox" type="checkbox"> <div class="toggle-switch"></div> <span class="toggle-label">Giao dịch</span> </label></div>';const e=u.querySelector(".toggle-checkbox");var r=t.createButton({align:"right"});r.setAttribute("title","Kết nối tài khoản chứng khoán"),r.innerHTML='<div class="item-headbar"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M17.31 8.25h-4.5l1.66-5.07a.94.94 0 0 0-.9-1.18H7.93a.94.94 0 0 0-.93.81L5.76 12.2a.94.94 0 0 0 .93 1.06h4.63l-1.8 7.6a.94.94 0 0 0 1.73.68l6.87-11.87a.94.94 0 0 0-.8-1.41Z"></path></svg></div><div>Kết nối</div></div>',r.addEventListener("click",function(){E()});var o=document.createElement("div");o.classList.add("ordercase-cover"),o.innerHTML=`<div class="ordercase"> 
						<button class="order-sellmp">BÁN MP</button> 
						<div> 
							<div class="order-sym-cover">
								<div class="order-sym"></div>
							</div>
							<div class="quant-case"> 
								<input class="order-quant" type="text" value="">
								<input class="order-ppse" style="display: none" type="text" value="" readonly> 
							</div>
						</div> 
						<button class="order-buymp">MUA MP</button> 
					</div>`,document.body.appendChild(o),J(".ordercase");const m=JSON.parse(localStorage.getItem("tradingHandle"));let n=m||{};e.addEventListener("change",function(){if(n.updateTime=new Date().getTime(),this.checked){const l=JSON.parse(localStorage.getItem("auth")),g=l?l.login_time:null,h=new Date().getTime()-g,K=8*60*60*1e3;if(h<=K){n.status="active",localStorage.setItem("tradingHandle",JSON.stringify(n)),o.style.display="block";const w=document.querySelector(".order-sym"),p=document.querySelector(".quant-case"),f=p.querySelector(".order-ppse"),v=document.querySelector(".order-quant");w.innerHTML=S(),v.value=m?m.quantIn:0,p.addEventListener("focusin",()=>{f.style.display="block"}),p.addEventListener("focusout",()=>{f.style.display="none"}),v.addEventListener("click",async function(){const a=j(),i=L(()=>a.dataSI),c=await se(S(),i.value.ceilingPrice*1e3);c?f.value=c.qmax.toLocaleString("en-US"):f.value="..."}),v.addEventListener("blur",function(){let a=v.value;if(a=parseFloat(a.replace(/,/g,"")),n.quantIn=a,localStorage.setItem("tradingHandle",JSON.stringify(n)),a%100!==0){this.value=100;const i={title:"Khối lượng không hợp lệ",body:"Nhập lô chẵn (100, 300, 1500, 2000,...) cổ phiếu"};t.showNoticeDialog(i)}});const X=document.querySelector(".order-buymp"),z=document.querySelector(".order-sellmp"),Q=(a,i,c)=>{const k=i.toLocaleString("en-US"),V={title:"Xác nhận",body:`${a==="BUY"?"Mua":"Bán"} MP ${k} cổ phiếu ${c}?`,callback:async W=>{if(W){const G=await oe(c,a,"MP",0,i);t.showNoticeDialog({title:"Thông báo",body:le(G.message)})}}};t.showConfirmDialog(V)},D=(a,i)=>{a.addEventListener("click",()=>{const c=parseFloat(v.value.replace(/,/g,"")),k=S();Q(i,c,k)})};D(X,"BUY"),D(z,"SELL")}else{const w={title:"Luồng kết nối tới CTCK đã hết hạn",body:"Bấm Yes để tiến hành kết nối lại!",callback:p=>{p&&E()}};e.checked=!1,t.showConfirmDialog(w)}}else{const l={title:"Đóng liên kết giao dịch",body:"Bạn có chắc không?",callback:g=>{g?(o.style.display="none",n.status="unactive",localStorage.setItem("tradingHandle",JSON.stringify(n))):e.checked=!0}};t.showConfirmDialog(l)}})}),d.value.onChartReady(()=>{d.value.activeChart().onSymbolChanged().subscribe(null,u=>{const e=u.ticker;P("update:symbol",e),U(e)})}),(x=window.frames[0])==null||x.focus()};return re(()=>{$(T.value)}),H(b,(s,t)=>{t&&y.value.unsubscribeBars(t)}),H(B,s=>{d.value.changeTheme(s)}),I({updateSymbol:Y}),(s,t)=>(ce(),de("div",{ref_key:"finsc_chart",ref:T,class:"trader w-full h-full"},null,512))}};export{Le as default};
