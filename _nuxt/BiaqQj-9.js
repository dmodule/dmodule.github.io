import{u as h}from"./DTastN19.js";import{u as p}from"./DgaNmZUo.js";import{D as m}from"./91SJFyQ2.js";import{bJ as f,a_ as c,u as _,bs as b,bq as g}from"./BD89yi6W.js";import{c as y}from"./BPC_65CJ.js";import"./B39OMRwo.js";import"./DxqHYnwt.js";import"./BLVB0qGI.js";import"./DdDBkiWh.js";import"./xIIEfSx2.js";const v={name:"FinscChart",data(){return{tvWidget:null,datafeed:null}},methods:{getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search);return s===null?"":decodeURIComponent(s[1].replace(/\+/g," "))},finscChart(t){var s,o;const e="https://app.finsc.vn/api/v1";this.datafeed=new m(e,5e3,{maxResponseLength:1e3,expectedOrder:"latestFirst"}),(s=y)==null||s.on("message",(a,r)=>{const i=JSON.parse(r);switch(a.split("/")[3]){case"TP":this.setDataTP(i);break;case"SI":this.setDataSI(i);break;default:return}}),this.tvWidget=window.tvWidget=new TradingView.widget({theme:this.colorMode,load_last_chart:!0,autosize:!1,width:"100%",height:"100%",symbol:this.symbol,interval:"1D",timezone:"Asia/Bangkok",container:t,datafeed:this.datafeed,library_path:"/static/tv/charting_library/",locale:this.getParameterByName("lang")||"en",enabled_features:["study_templates"],charts_storage_url:e,client_id:this.userId,user_id:this.userId,auto_save_delay:10,charts_storage_api_version:"1.1",disabled_features:["popup_hints"]}),this.tvWidget.onChartReady(()=>{this.tvWidget.activeChart().onSymbolChanged().subscribe(null,a=>{const r=a.ticker;this.setSymbol(r)})}),(o=window.frames[0])==null||o.focus()},updateSymbol(t){this.tvWidget.chart().setSymbol(t)}},watch:{symbol(t,e){e&&this.datafeed.unsubscribeBars(e)},colorMode(t){this.tvWidget.changeTheme(t)}},setup(){const{getProfile:t}=p(),{sub:e}=t(),o=e.split("|")[1],{symbol:a,setSymbol:r,setDataSI:i,setDataTP:n}=h(),l=c(()=>a),{$colorMode:d}=_(),u=c(()=>d.value);return{userId:o,symbol:l,setSymbol:r,setDataSI:i,setDataTP:n,colorMode:u}},mounted(){this.finscChart(this.$el)}},w={ref:"finsc_chart",class:"trader w-full h-full"};function S(t,e,s,o,a,r){return b(),g("div",w,null,512)}const M=f(v,[["render",S]]);export{M as default};
